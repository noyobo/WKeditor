/*!build time : 2014-07-03 5:07:25 PM*/
KISSY.add(function(a,b){function c(a){var b=this;b.options=a,b.regExp=/(?:www|i)\.xiami\.com\/(?:\w+\/)?(song|album|demo|showcollect\/id)\/(\d+)/}var d=b.all;return c.prototype.tpl={wrap:'<div class="WKeditor_music_plate">            <table><tr><td width="80%">            <input key="toClear" title="\u8bf7\u7c98\u8d34\u867e\u7c73\u97f3\u4e50\u9875\u9762\u5730\u5740" placeholder="\u8bf7\u7c98\u8d34\u867e\u7c73\u97f3\u4e50\u9875\u9762\u5730\u5740"/>            </td><td width="20%"><a href="javascript:void(0);" class="btn-confirm wk-btn btn-bg-blue btn-large">\u786e\u8ba4\u4e0a\u4f20</a></td></tr></table>            <div class="close">\xd7</div></div>'},c.prototype.view=function(){var a=this;a.$video=d(a.tpl.wrap),d("body").append(a.$video),a.view.setVideoPlatePosition=function(){a.$video.width(a.ele.width()).show();var b=(d(window).height()-a.$video.outerHeight())/2+d(window).scrollTop(),c=(d(window).width()-a.$video.width())/2;0>b&&(b=5),a.$video.css({zIndex:100,left:c,top:b})},a.view.setVideoPlatePosition(),a.$overlay=a.tool.overlay({ele:a.$video}).$overlay,a.view.preview=function(a,b){var c=d("<p class='musicBox'></p>"),e=document.createElement("embed");if("song"===b||"demo"===b){var f="http://www.xiami.com/widget/0_"+a+"/singlePlayer.swf";e.setAttribute("height","33"),e.setAttribute("width","257")}if("album"===b){var f="http://www.xiami.com/widget/0_"+a+"_235_346_FF8719_494949/albumPlayer.swf";e.setAttribute("height","346"),e.setAttribute("width","235")}if("showcollect/id"===b){var f="http://www.xiami.com/widget/0_"+a+"_235_346_FF8719_494949_0/collectPlayer.swf";e.setAttribute("height","346"),e.setAttribute("width","235")}return e.setAttribute("allowscriptaccess","never"),e.setAttribute("type","application/x-shockwave-flash"),e.setAttribute("wmode","transparent"),e.setAttribute("style","display:inline-block"),e.setAttribute("src",f),c.append(e),c},a.view.insertVideo=function(b){var c=a.regExp.exec(b);if(!c)return void alert("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u867e\u7c73\u6b4c\u66f2\u9875\u9762\u5730\u5740");var d=c[1],e=c[2];a.doit(e,d)},a.$insertArea=a.tool.insertArea()},c.prototype.doit=function(a,b){var c=this,d=c.view.preview(a,b);c.$insertArea.before(d),c.$insertArea.remove(),c.$overlay.remove(),c.$video.remove(),c.tool.setCart(d[0],c.options.range)},c.prototype.event=function(){var a=this,b=a.$video.one(".btn-confirm");b.on("click",function(){var b=a.$video.one("input").val();a.view.insertVideo(b)}),d(window).on("resize",function(){a.view.setVideoPlatePosition()}),a.$video.one(".close").on("click",function(){a.$video.remove(),a.$overlay.remove(),a.$insertArea.remove(),a.$wrap.fire("blur")}),a.$video.one("input").fire("focus")},c.prototype.init=function(){this.ele=this.options.ele,this.left=this.options.left,this.top=this.options.top,this.$wrap=this.options.$wrap,this.tool=this.options.tool,this.browser=this.tool.browser(),this.view(),this.event()},c},{requires:["node","./WKmusic.css"]});